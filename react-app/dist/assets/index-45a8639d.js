import{r as j,a as L,R as O}from"./vendor-57209f9c.js";import{P as C}from"./plotly-390a6e20.js";import{a as P}from"./utils-16f98fc8.js";import"ext/globalThis-this";import"css-globalThis-keywords";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))l(t);new MutationObserver(t=>{for(const s of t)if(s.type==="childList")for(const m of s.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&l(m)}).observe(document,{childList:!0,subtree:!0});function n(t){const s={};return t.integrity&&(s.integrity=t.integrity),t.referrerPolicy&&(s.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?s.credentials="include":t.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function l(t){if(t.ep)return;t.ep=!0;const s=n(t);fetch(t.href,s)}})();var k={exports:{}},A={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var M=j,T=Symbol.for("react.element"),_=Symbol.for("react.fragment"),R=Object.prototype.hasOwnProperty,Y=M.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,V={key:!0,ref:!0,__self:!0,__source:!0};function E(d,a,n){var l,t={},s=null,m=null;n!==void 0&&(s=""+n),a.key!==void 0&&(s=""+a.key),a.ref!==void 0&&(m=a.ref);for(l in a)R.call(a,l)&&!V.hasOwnProperty(l)&&(t[l]=a[l]);if(d&&d.defaultProps)for(l in a=d.defaultProps,a)t[l]===void 0&&(t[l]=a[l]);return{$$typeof:T,type:d,key:s,ref:m,props:t,_owner:Y.current}}A.Fragment=_;A.jsx=E;A.jsxs=E;k.exports=A;var e=k.exports,$={},F=L;$.createRoot=F.createRoot,$.hydrateRoot=F.hydrateRoot;const U=({data:d,ticker:a,period:n})=>{const l=j.useMemo(()=>{var f,g,N,v;if(!(d!=null&&d.data)||d.data.length===0)return null;const m=d.data,{minSlope120:r,minSlope200:c}=d.analysis;let o=m;n!=="max"&&m.displayStartDate&&(o=m.filter(x=>new Date(x.date)>=m.displayStartDate),console.log(`🎯 Display data filtered: ${o.length} days for chart (${n} years)`));const p=o.map(x=>x.date),h=o.map(x=>x.close),i=o.map(x=>x.ma120||null),y=o.map(x=>x.ma200||null);console.log(`📊 Chart data: ${p.length} points`),console.log(`📈 Price range: $${Math.min(...h.filter(x=>x)).toFixed(2)} - $${Math.max(...h).toFixed(2)}`),console.log(`🔴 120일 이평 유효 포인트: ${i.filter(x=>x!==null).length}개`),console.log(`🔵 200일 이평 유효 포인트: ${y.filter(x=>x!==null).length}개`);const u=[{x:p,y:h,type:"scatter",mode:"lines",name:"Close Price",line:{color:"darkgray",width:1},hovertemplate:"<b>%{x}</b><br>Close: $%{y:.2f}<extra></extra>"},{x:p,y:i,type:"scatter",mode:"lines",name:"120-day MA",line:{color:"red",width:2},hovertemplate:"<b>%{x}</b><br>120-day MA: $%{y:.2f}<extra></extra>"},{x:p,y,type:"scatter",mode:"lines",name:"200-day MA",line:{color:"blue",width:2},hovertemplate:"<b>%{x}</b><br>200-day MA: $%{y:.2f}<extra></extra>"}];if(r&&r.ma120!==null){const x=new Date(r.date),S=new Date(p[0]),w=new Date(p[p.length-1]),b=x>=S&&x<=w;console.log(`🔴 120일 신호 지점: ${r.date}`),console.log(`📊 차트 범위: ${p[0]} ~ ${p[p.length-1]}`),console.log(`✅ 신호 지점 차트 내 포함: ${b?"YES":"NO"}`),b?(console.log(`🔴 Adding 120일 마커: ${r.date} at $${r.ma120.toFixed(2)} (기울기: ${(f=r.ma120Slope)==null?void 0:f.toFixed(6)})`),u.push({x:[r.date],y:[r.ma120],type:"scatter",mode:"markers+text",name:"Lowest Slope Point 120 MA",marker:{color:"red",size:12,symbol:"circle",line:{color:"white",width:2}},text:["Lowest Slope 120 MA"],textposition:"top center",textfont:{size:10,color:"red",family:"Arial"},hovertemplate:`<b>🔴 120일 최저 기울기 지점</b><br><b>날짜:</b> %{x}<br><b>120일 이평:</b> $%{y:.2f}<br><b>기울기:</b> ${(g=r.ma120Slope)==null?void 0:g.toFixed(6)}<extra></extra>`,showlegend:!0})):console.log("⚠️ 120일 신호 지점이 차트 범위 밖에 있음")}if(c&&c.ma200!==null){const x=new Date(c.date),S=new Date(p[0]),w=new Date(p[p.length-1]),b=x>=S&&x<=w;console.log(`🔵 200일 신호 지점: ${c.date}`),console.log(`📊 차트 범위: ${p[0]} ~ ${p[p.length-1]}`),console.log(`✅ 신호 지점 차트 내 포함: ${b?"YES":"NO"}`),b?(console.log(`🔵 Adding 200일 마커: ${c.date} at $${c.ma200.toFixed(2)} (기울기: ${(N=c.ma200Slope)==null?void 0:N.toFixed(6)})`),u.push({x:[c.date],y:[c.ma200],type:"scatter",mode:"markers+text",name:"Lowest Slope Point 200 MA",marker:{color:"blue",size:12,symbol:"star",line:{color:"white",width:2}},text:["Lowest Slope 200 MA"],textposition:"top center",textfont:{size:10,color:"blue",family:"Arial"},hovertemplate:`<b>🔵 200일 최저 기울기 지점</b><br><b>날짜:</b> %{x}<br><b>200일 이평:</b> $%{y:.2f}<br><b>기울기:</b> ${(v=c.ma200Slope)==null?void 0:v.toFixed(6)}<extra></extra>`,showlegend:!0})):console.log("⚠️ 200일 신호 지점이 차트 범위 밖에 있음")}return console.log(`📊 Chart traces generated: ${u.length} traces`),console.log(`📈 Data points: ${p.length}`),console.log(`🔴 120일 신호 표시: ${r?"YES":"NO"}`),console.log(`🔵 200일 신호 표시: ${c?"YES":"NO"}`),u},[d]),t={title:{text:`${a} Stock Price and Moving Averages (${n==="max"?"Max":n+" years"})`,font:{size:18,family:"Arial, sans-serif"}},xaxis:{title:"Date",type:"date",showgrid:!0,gridcolor:"#f0f0f0"},yaxis:{title:"Price ($)",showgrid:!0,gridcolor:"#f0f0f0"},hovermode:"x unified",showlegend:!0,legend:{x:0,y:1,bgcolor:"rgba(255,255,255,0.9)",bordercolor:"#ddd",borderwidth:1},plot_bgcolor:"#fafafa",paper_bgcolor:"white",margin:{t:80,r:30,b:60,l:80},height:600},s={responsive:!0,displayModeBar:!0,modeBarButtonsToRemove:["lasso2d","select2d","autoScale2d","hoverClosestCartesian","hoverCompareCartesian","toggleSpikelines"],displaylogo:!1,toImageButtonOptions:{format:"png",filename:`${a}_moving_averages_${n}y`,height:600,width:1e3,scale:1}};return l?e.jsxs("div",{className:"chart-container",children:[e.jsxs("div",{className:"chart-header",children:[e.jsxs("h2",{children:["📊 ",a," 주식 차트"]}),e.jsxs("div",{className:"chart-info",children:[e.jsxs("span",{children:["📈 총 ",d.data.length,"일 데이터"]}),e.jsxs("span",{children:["🔴 120일 이평 ",d.analysis.ma120Days,"개"]}),e.jsxs("span",{children:["🔵 200일 이평 ",d.analysis.ma200Days,"개"]})]})]}),e.jsx(C,{data:l,layout:t,config:s,style:{width:"100%",height:"600px"},useResizeHandler:!0})]}):e.jsx("div",{className:"chart-container",children:e.jsx("div",{className:"chart-placeholder",children:e.jsx("p",{children:"차트 데이터를 불러오는 중..."})})})},H=({onLoadData:d,loading:a,defaultTicker:n="QQQ"})=>{const[l,t]=j.useState(n),[s,m]=j.useState("3"),r=[{value:"3",label:"3 years"},{value:"6",label:"6 years"},{value:"9",label:"9 years"},{value:"12",label:"12 years"},{value:"max",label:"Max"}],c=i=>{i.preventDefault(),l.trim()&&!a&&d(l.trim().toUpperCase(),s)},o=i=>{t(i.target.value.toUpperCase())},p=i=>{t(i),a||d(i,s)},h=["MSFT","AAPL","NVDA","GOOGL","TSLA","AMZN","TSM","LLY","NOV","AVGO","ORCL","NFLX","META","QQQ","SPY"];return e.jsxs("div",{className:"controls-container",children:[e.jsxs("form",{onSubmit:c,className:"stock-controls",children:[e.jsxs("div",{className:"control-group",children:[e.jsx("label",{htmlFor:"ticker",className:"control-label",children:"주식 티커:"}),e.jsxs("div",{className:"ticker-input-container",children:[e.jsx("input",{id:"ticker",type:"text",value:l,onChange:o,placeholder:"AAPL, MSFT, QQQ...",className:"ticker-input",disabled:a,maxLength:10}),e.jsxs("div",{className:"input-hint",children:["예시: ",h.slice(0,4).join(", ")]})]})]}),e.jsxs("div",{className:"control-group",children:[e.jsx("label",{htmlFor:"period",className:"control-label",children:"기간:"}),e.jsx("select",{id:"period",value:s,onChange:i=>m(i.target.value),className:"period-select",disabled:a,children:r.map(i=>e.jsx("option",{value:i.value,children:i.label},i.value))})]}),e.jsx("button",{type:"submit",className:`load-button ${a?"loading":""}`,disabled:a||!l.trim(),children:a?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner"}),"Loading..."]}):"📊 Load Data"})]}),e.jsxs("div",{className:"quick-select",children:[e.jsx("h3",{children:"빠른 선택:"}),e.jsx("div",{className:"quick-buttons",children:h.map(i=>e.jsx("button",{onClick:()=>p(i),className:`quick-button ${l===i?"active":""}`,disabled:a,title:`${i} 데이터 로드`,children:i},i))})]})]})},Q=({data:d,ticker:a})=>{var o,p,h,i,y,u;const n=j.useMemo(()=>{if(!(d!=null&&d.data)||!d.analysis)return null;const{minSlope120:f,minSlope200:g}=d.analysis,N=d.data,v=N[N.length-1];return{minSlope120:f,minSlope200:g,latestData:v,totalDays:N.length,ma120Days:d.analysis.ma120Days,ma200Days:d.analysis.ma200Days}},[d]);if(!n)return e.jsx("div",{className:"analysis-placeholder",children:"분석 데이터가 없습니다."});const{minSlope120:l,minSlope200:t,latestData:s}=n,m=f=>f?f>.5?{text:"강한 상승",emoji:"🚀",className:"strong-up"}:f>0?{text:"상승",emoji:"📈",className:"up"}:f<-.5?{text:"강한 하락",emoji:"📉",className:"strong-down"}:f<0?{text:"하락",emoji:"📉",className:"down"}:{text:"보합",emoji:"➡️",className:"neutral"}:{text:"N/A",emoji:"❓",className:"neutral"},r=m(s.ma120Slope),c=m(s.ma200Slope);return e.jsxs("div",{className:"analysis-container",children:[e.jsxs("div",{className:"analysis-header",children:[e.jsxs("h2",{children:["📊 ",a," 이동평균선 분석"]}),e.jsxs("div",{className:"analysis-summary",children:[e.jsxs("span",{children:["총 ",n.totalDays,"일 데이터"]}),e.jsx("span",{children:"|"}),e.jsxs("span",{children:["120일 이평: ",n.ma120Days,"개"]}),e.jsx("span",{children:"|"}),e.jsxs("span",{children:["200일 이평: ",n.ma200Days,"개"]})]})]}),e.jsxs("div",{className:"analysis-grid",children:[l&&e.jsxs("div",{className:"analysis-card slope-analysis",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("h3",{children:"🔴 120일 이동평균 최저 기울기 지점"}),e.jsx("span",{className:"signal-marker",children:"● 원형 마커"})]}),e.jsxs("div",{className:"card-content",children:[e.jsxs("div",{className:"metric-row",children:[e.jsx("span",{className:"metric-label",children:"📅 날짜:"}),e.jsx("span",{className:"metric-value",children:l.date})]}),e.jsxs("div",{className:"metric-row",children:[e.jsx("span",{className:"metric-label",children:"💰 120일 이평가:"}),e.jsxs("span",{className:"metric-value",children:["$",(o=l.ma120)==null?void 0:o.toFixed(2)]})]}),e.jsxs("div",{className:"metric-row",children:[e.jsx("span",{className:"metric-label",children:"📉 기울기:"}),e.jsx("span",{className:"metric-value negative",children:(p=l.ma120Slope)==null?void 0:p.toFixed(6)})]}),e.jsxs("div",{className:"metric-row",children:[e.jsx("span",{className:"metric-label",children:"📊 차트 표시:"}),e.jsxs("span",{className:"signal-indicator",children:[e.jsx("span",{className:"signal-dot red"}),"빨간 원형 마커로 표시됨"]})]}),e.jsxs("p",{className:"analysis-note",children:[e.jsx("strong",{children:"📍 차트에서 빨간색 원형(●) 마커를 확인하세요!"}),e.jsx("br",{}),"이 지점은 120일 이동평균선의 기울기가 가장 급격하게 하락한 시점으로, 시장 조정이나 하락 트렌드의 가속화를 나타냅니다."]})]})]}),t&&e.jsxs("div",{className:"analysis-card slope-analysis",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("h3",{children:"🔵 200일 이동평균 최저 기울기 지점"}),e.jsx("span",{className:"signal-marker",children:"★ 별 마커"})]}),e.jsxs("div",{className:"card-content",children:[e.jsxs("div",{className:"metric-row",children:[e.jsx("span",{className:"metric-label",children:"📅 날짜:"}),e.jsx("span",{className:"metric-value",children:t.date})]}),e.jsxs("div",{className:"metric-row",children:[e.jsx("span",{className:"metric-label",children:"💰 200일 이평가:"}),e.jsxs("span",{className:"metric-value",children:["$",(h=t.ma200)==null?void 0:h.toFixed(2)]})]}),e.jsxs("div",{className:"metric-row",children:[e.jsx("span",{className:"metric-label",children:"📉 기울기:"}),e.jsx("span",{className:"metric-value negative",children:(i=t.ma200Slope)==null?void 0:i.toFixed(6)})]}),e.jsxs("div",{className:"metric-row",children:[e.jsx("span",{className:"metric-label",children:"📊 차트 표시:"}),e.jsxs("span",{className:"signal-indicator",children:[e.jsx("span",{className:"signal-dot blue",children:"★"}),"파란 별형 마커로 표시됨"]})]}),e.jsxs("p",{className:"analysis-note",children:[e.jsx("strong",{children:"📍 차트에서 파란색 별형(★) 마커를 확인하세요!"}),e.jsx("br",{}),"이 지점은 200일 이동평균선의 기울기가 가장 급격하게 하락한 시점으로, 장기 트렌드 전환점을 나타낼 가능성이 높습니다."]})]})]}),s.ma120&&s.ma200&&e.jsxs("div",{className:"analysis-card current-trend",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("h3",{children:"📈 현재 트렌드 분석"}),e.jsx("span",{className:"latest-date",children:s.date})]}),e.jsxs("div",{className:"card-content",children:[e.jsxs("div",{className:"trend-row",children:[e.jsx("span",{className:"trend-label",children:"120일 이평 트렌드:"}),e.jsxs("span",{className:`trend-value ${r.className}`,children:[r.emoji," ",r.text,e.jsxs("small",{children:["(",s.ma120Slope>0?"+":"",(y=s.ma120Slope)==null?void 0:y.toFixed(4),")"]})]})]}),e.jsxs("div",{className:"trend-row",children:[e.jsx("span",{className:"trend-label",children:"200일 이평 트렌드:"}),e.jsxs("span",{className:`trend-value ${c.className}`,children:[c.emoji," ",c.text,e.jsxs("small",{children:["(",s.ma200Slope>0?"+":"",(u=s.ma200Slope)==null?void 0:u.toFixed(4),")"]})]})]}),e.jsx("div",{className:"separator"}),e.jsxs("div",{className:"price-position",children:[e.jsx("h4",{children:"💰 현재 주가 포지션"}),e.jsxs("div",{className:"position-row",children:[e.jsx("span",{children:"현재가:"}),e.jsxs("span",{className:"current-price",children:["$",s.close.toFixed(2)]})]}),e.jsxs("div",{className:"position-row",children:[e.jsx("span",{children:"120일 이평 대비:"}),e.jsxs("span",{className:s.close>s.ma120?"above":"below",children:[s.close>s.ma120?"✅ 상회":"❌ 하회",e.jsxs("small",{children:["(",((s.close/s.ma120-1)*100).toFixed(1),"%)"]})]})]}),e.jsxs("div",{className:"position-row",children:[e.jsx("span",{children:"200일 이평 대비:"}),e.jsxs("span",{className:s.close>s.ma200?"above":"below",children:[s.close>s.ma200?"✅ 상회":"❌ 하회",e.jsxs("small",{children:["(",((s.close/s.ma200-1)*100).toFixed(1),"%)"]})]})]})]})]})]}),e.jsxs("div",{className:"analysis-card technical-signals",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{children:"🎯 기술적 신호"})}),e.jsxs("div",{className:"card-content",children:[s.ma120&&s.ma200&&e.jsxs("div",{className:"signal-item",children:[e.jsx("span",{className:"signal-label",children:"골든 크로스/데드 크로스:"}),e.jsx("span",{className:`signal-value ${s.ma120>s.ma200?"bullish":"bearish"}`,children:s.ma120>s.ma200?"🌟 골든 크로스 (강세)":"💀 데드 크로스 (약세)"})]}),e.jsxs("div",{className:"signal-item",children:[e.jsx("span",{className:"signal-label",children:"120일 이평 모멘텀:"}),e.jsxs("span",{className:`signal-value ${r.className}`,children:[r.emoji," ",r.text]})]}),e.jsxs("div",{className:"signal-item",children:[e.jsx("span",{className:"signal-label",children:"200일 이평 모멘텀:"}),e.jsxs("span",{className:`signal-value ${c.className}`,children:[c.emoji," ",c.text]})]})]})]})]})]})},G=()=>e.jsxs("div",{className:"loading-spinner",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"주식 데이터를 불러오는 중..."}),e.jsx("small",{children:"잠시만 기다려주세요"})]}),z=({message:d})=>e.jsxs("div",{className:"error-message",children:[e.jsx("strong",{children:"⚠️ 오류 발생:"})," ",d]}),I={ALPHA_VANTAGE:{baseURL:"https://www.alphavantage.co/query",key:"demo",function:"TIME_SERIES_DAILY"},FINNHUB:{baseURL:"https://finnhub.io/api/v1",key:"demo"},POLYGON:{baseURL:"https://api.polygon.io/v2",key:"demo"}};class B{constructor(){this.currentAPI="YAHOO_DIRECT",this.cache=new Map,this.rateLimitDelay=1e3}setAPIKey(a,n){I[a].key=n}async fetchStockData(a,n="3"){const l=`${a}_${n}`;if(this.cache.has(l))return console.log("📦 Using cached data for",l),this.cache.get(l);try{let t;switch(this.currentAPI){case"YAHOO_DIRECT":t=await this.fetchFromYahooDirect(a,n);break;case"ALPHA_VANTAGE":t=await this.fetchFromAlphaVantage(a,n);break;case"FINNHUB":t=await this.fetchFromFinnhub(a,n);break;default:throw new Error(`Unsupported API: ${this.currentAPI}`)}const s=this.processStockData(t,a,n);return this.cache.set(l,s),setTimeout(()=>this.cache.delete(l),10*60*1e3),s}catch(t){throw console.error("Error fetching stock data:",t),this.handleAPIError(t)}}async fetchFromYahooDirect(a,n){const l=new Date,t=new Date;if(n==="max")t.setFullYear(t.getFullYear()-20);else{const o=parseInt(n);t.setFullYear(t.getFullYear()-o-1)}const s=Math.floor(t.getTime()/1e3),m=Math.floor(l.getTime()/1e3),r=`https://query1.finance.yahoo.com/v7/finance/download/${a}?period1=${s}&period2=${m}&interval=1d&events=history&includeAdjustedClose=true`,c=`https://api.allorigins.win/raw?url=${encodeURIComponent(r)}`;console.log(`🚀 Fetching from Yahoo Finance via CORS proxy for ${a} (period: ${n})`),console.log(`📅 Date range: ${t.toISOString().split("T")[0]} to ${l.toISOString().split("T")[0]}`),console.log(`🔗 Using proxy: ${c}`);try{const o=await P.get(c,{timeout:3e4,responseType:"text",headers:{Accept:"text/csv"}});if(!o.data||o.data.includes("error")||!o.data.includes("Date"))throw new Error("Invalid CSV response from Yahoo Finance");return console.log(`📊 Got ${o.data.split(`
`).length-1} lines from Yahoo Finance`),this.parseYahooCSV(o.data,n)}catch(o){return console.error("Yahoo Finance Direct API failed:",o),console.log("🔄 Fallback to Alpha Vantage..."),this.currentAPI="ALPHA_VANTAGE",await this.fetchFromAlphaVantage(a,n)}}parseYahooCSV(a,n){var m,r;const l=a.trim().split(`
`),t=l[0].split(",");console.log(`📊 CSV Headers: ${t.join(", ")}`);const s=[];for(let c=1;c<l.length;c++){const o=l[c].split(",");o.length<6||o[4]==="null"||s.push({date:o[0],open:parseFloat(o[1]),high:parseFloat(o[2]),low:parseFloat(o[3]),close:parseFloat(o[4]),volume:parseInt(o[6]||o[5])})}if(s.sort((c,o)=>new Date(c.date)-new Date(o.date)),n!=="max"){const c=parseInt(n),o=new Date,p=new Date;p.setFullYear(p.getFullYear()-c),s.displayStartDate=p,s.displayEndDate=o,console.log(`🎯 Display period will be: ${p.toISOString().split("T")[0]} to ${o.toISOString().split("T")[0]}`)}return console.log(`📈 Parsed ${s.length} days from Yahoo Finance CSV`),console.log(`📅 Full data range: ${(m=s[0])==null?void 0:m.date} to ${(r=s[s.length-1])==null?void 0:r.date}`),s}async fetchFromAlphaVantage(a,n){const{baseURL:l,key:t,function:s}=I.ALPHA_VANTAGE,m={function:s,symbol:a,outputsize:"full",apikey:t};console.log(`🚀 Fetching FULL data from Alpha Vantage for ${a} (period: ${n})`),console.log("📊 Using outputsize=full to ensure sufficient data for 200-day MA");const r=await P.get(l,{params:m,timeout:3e4});if(r.data["Error Message"])throw new Error(`Invalid symbol: ${a}`);if(r.data.Note)throw new Error("API rate limit exceeded. Please try again later.");const c=r.data["Time Series (Daily)"];if(!c)throw new Error("No data received from API");const o=this.convertAlphaVantageData(c,n);return console.log(`📈 Fetched ${o.length} days of data`),o}convertAlphaVantageData(a,n){var t,s;const l=Object.entries(a).map(([m,r])=>({date:m,close:parseFloat(r["4. close"]),open:parseFloat(r["1. open"]),high:parseFloat(r["2. high"]),low:parseFloat(r["3. low"]),volume:parseInt(r["5. volume"])})).sort((m,r)=>new Date(m.date)-new Date(r.date));if(console.log(`📅 Full data range: ${(t=l[0])==null?void 0:t.date} to ${(s=l[l.length-1])==null?void 0:s.date}`),n!=="max"){const m=parseInt(n),r=new Date,c=new Date;c.setFullYear(c.getFullYear()-m);const o=new Date(c);o.setDate(o.getDate()-250),console.log(`📊 Filtering data: ${o.toISOString().split("T")[0]} to ${r.toISOString().split("T")[0]}`),console.log(`🎯 Target period: ${c.toISOString().split("T")[0]} to ${r.toISOString().split("T")[0]} (${m} years)`);const p=l.filter(h=>{const i=new Date(h.date);return i>=o&&i<=r});return console.log(`📈 Filtered to ${p.length} days (includes buffer for moving averages)`),p.displayStartDate=c,p.displayEndDate=r,p}return console.log(`📈 Using all ${l.length} days (Max period)`),l}processStockData(a,n,l){var o,p;if(!a||a.length===0)throw new Error("No data available");console.log(`📊 Processing ${a.length} days of data for ${n}`),console.log(`📅 Data date range: ${(o=a[0])==null?void 0:o.date} to ${(p=a[a.length-1])==null?void 0:p.date}`),a.length<200&&console.warn(`⚠️ Warning: Only ${a.length} days of data available. 200-day MA may be incomplete.`);const t=a.map((h,i)=>{const y={...h};if(i>=119){const u=a.slice(i-119,i+1).reduce((f,g)=>f+g.close,0);y.ma120=u/120}else y.ma120=null;if(i>=199){const u=a.slice(i-199,i+1).reduce((f,g)=>f+g.close,0);y.ma200=u/200}else y.ma200=null;return y});t.forEach((h,i)=>{i>0?(h.ma120!==null&&t[i-1].ma120!==null?h.ma120Slope=h.ma120-t[i-1].ma120:h.ma120Slope=null,h.ma200!==null&&t[i-1].ma200!==null?h.ma200Slope=h.ma200-t[i-1].ma200:h.ma200Slope=null):(h.ma120Slope=null,h.ma200Slope=null)});const s=t.filter(h=>h.ma120Slope!==null&&!isNaN(h.ma120Slope)),m=t.filter(h=>h.ma200Slope!==null&&!isNaN(h.ma200Slope));let r=null,c=null;return s.length>0&&(r=s.reduce((h,i)=>i.ma120Slope<h.ma120Slope?i:h),console.log(`🔴 120일 최저 기울기: ${r.date} = ${r.ma120Slope.toFixed(6)}`)),m.length>0&&(c=m.reduce((h,i)=>i.ma200Slope<h.ma200Slope?i:h),console.log(`🔵 200일 최저 기울기: ${c.date} = ${c.ma200Slope.toFixed(6)}`)),{ticker:n.toUpperCase(),period:l,data:t,analysis:{minSlope120:r,minSlope200:c,totalDays:t.length,ma120Days:s.length,ma200Days:m.length}}}handleAPIError(a){var n,l,t;return a.code==="ECONNABORTED"||a.message.includes("timeout")?new Error("Request timeout. Please try again."):((n=a.response)==null?void 0:n.status)===429?new Error("API rate limit exceeded. Please wait a moment and try again."):((l=a.response)==null?void 0:l.status)===401||((t=a.response)==null?void 0:t.status)===403?new Error("API key invalid or expired. Please check your API configuration."):a}async checkAPIStatus(){try{return await this.fetchStockData("AAPL","1"),{status:"ok",api:this.currentAPI}}catch(a){return{status:"error",error:a.message,api:this.currentAPI}}}}const D=new B,q=({onClose:d})=>{const[a,n]=j.useState(""),[l,t]=j.useState("ALPHA_VANTAGE"),s=()=>{a.trim()?(D.setAPIKey(l,a.trim()),alert("API 키가 저장되었습니다!"),d()):alert("API 키를 입력해주세요.")};return e.jsxs("div",{className:"api-settings",children:[e.jsxs("div",{className:"settings-header",children:[e.jsx("h3",{children:"⚙️ API 설정"}),e.jsx("button",{onClick:d,className:"close-btn",children:"✕"})]}),e.jsxs("div",{className:"settings-content",children:[e.jsxs("div",{className:"setting-group",children:[e.jsx("label",{children:"API 선택:"}),e.jsxs("select",{value:l,onChange:m=>t(m.target.value),children:[e.jsx("option",{value:"ALPHA_VANTAGE",children:"Alpha Vantage (추천)"}),e.jsx("option",{value:"FINNHUB",children:"Finnhub"})]})]}),e.jsxs("div",{className:"setting-group",children:[e.jsx("label",{children:"API 키:"}),e.jsx("input",{type:"text",value:a,onChange:m=>n(m.target.value),placeholder:"API 키를 입력하세요"})]}),e.jsxs("div",{className:"api-info",children:[l==="ALPHA_VANTAGE"&&e.jsxs("p",{children:["무료 키: ",e.jsx("a",{href:"https://www.alphavantage.co/support/#api-key",target:"_blank",rel:"noopener noreferrer",children:"alphavantage.co"})," (500 calls/day)"]}),l==="FINNHUB"&&e.jsxs("p",{children:["무료 키: ",e.jsx("a",{href:"https://finnhub.io",target:"_blank",rel:"noopener noreferrer",children:"finnhub.io"})," (60 calls/minute)"]})]}),e.jsxs("div",{className:"settings-actions",children:[e.jsx("button",{onClick:s,className:"save-btn",children:"저장"}),e.jsx("button",{onClick:d,className:"cancel-btn",children:"취소"})]})]}),e.jsx("style",{jsx:!0,children:`
        .api-settings {
          background: white;
          border-radius: 12px;
          padding: 1.5rem;
          margin-bottom: 1rem;
          box-shadow: 0 4px 20px rgba(0,0,0,0.15);
          border: 1px solid #e1e8ed;
        }
        
        .settings-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 1rem;
          padding-bottom: 0.5rem;
          border-bottom: 1px solid #e9ecef;
        }
        
        .close-btn {
          background: none;
          border: none;
          font-size: 1.2rem;
          cursor: pointer;
          color: #666;
        }
        
        .setting-group {
          margin-bottom: 1rem;
        }
        
        .setting-group label {
          display: block;
          margin-bottom: 0.5rem;
          font-weight: 600;
          color: #555;
        }
        
        .setting-group input,
        .setting-group select {
          width: 100%;
          padding: 0.75rem;
          border: 2px solid #e1e8ed;
          border-radius: 6px;
          font-size: 0.9rem;
        }
        
        .api-info {
          background: #f8f9fa;
          padding: 0.75rem;
          border-radius: 6px;
          margin-bottom: 1rem;
          font-size: 0.9rem;
        }
        
        .api-info a {
          color: #667eea;
          text-decoration: none;
        }
        
        .settings-actions {
          display: flex;
          gap: 0.5rem;
          justify-content: flex-end;
        }
        
        .save-btn, .cancel-btn {
          padding: 0.5rem 1rem;
          border: none;
          border-radius: 6px;
          cursor: pointer;
          font-weight: 600;
        }
        
        .save-btn {
          background: #667eea;
          color: white;
        }
        
        .cancel-btn {
          background: #e9ecef;
          color: #555;
        }
      `})]})};function K(){const[d,a]=j.useState(null),[n,l]=j.useState(!1),[t,s]=j.useState(null),[m,r]=j.useState(""),[c,o]=j.useState(""),[p,h]=j.useState(!1);j.useEffect(()=>{i()},[]);const i=async()=>{try{const u=await D.checkAPIStatus();u.status==="error"&&console.warn("API Status:",u.error)}catch(u){console.warn("Failed to check API status:",u.message)}},y=j.useCallback(async(u,f)=>{if(!(u!=null&&u.trim())){s("주식 티커 심볼을 입력해주세요");return}l(!0),s(null);try{console.log(`📈 Loading data for ${u.toUpperCase()}, period: ${f}`);const g=await D.fetchStockData(u,f);g&&g.data&&g.data.length>0?(a(g),r(u.toUpperCase()),o(f),console.log(`✅ Successfully loaded ${g.data.length} days of data`),console.log(`📊 120-day MA points: ${g.analysis.ma120Days}`),console.log(`📊 200-day MA points: ${g.analysis.ma200Days}`)):(s("입력한 티커에 대한 데이터를 찾을 수 없습니다"),a(null))}catch(g){console.error("Error loading stock data:",g),s(g.message||"주식 데이터를 불러오는데 실패했습니다. 다시 시도해주세요."),a(null)}finally{l(!1)}},[]);return e.jsxs("div",{className:"app",children:[e.jsx("header",{className:"app-header",children:e.jsxs("div",{className:"header-content",children:[e.jsx("h1",{children:"📈 Stock Moving Averages Visualization"}),e.jsx("p",{children:"원본 yfiance-ma.py와 동일한 분석 로직 | React + 무료 API"}),e.jsx("button",{className:"api-settings-btn",onClick:()=>h(!p),children:"⚙️ API 설정"})]})}),e.jsxs("main",{className:"app-main",children:[p&&e.jsx(q,{onClose:()=>h(!1)}),e.jsx(H,{onLoadData:y,loading:n,defaultTicker:"QQQ"}),t&&e.jsx(z,{message:t}),n&&e.jsx(G,{}),d&&!n&&e.jsxs(e.Fragment,{children:[e.jsx(U,{data:d,ticker:m,period:c}),e.jsx(Q,{data:d,ticker:m})]}),!d&&!n&&!t&&e.jsx("div",{className:"welcome-message",children:e.jsxs("div",{className:"welcome-card",children:[e.jsx("h2",{children:"📊 주식 이동평균선 분석"}),e.jsx("p",{children:'주식 티커를 입력하고 "Load Data" 버튼을 클릭하세요.'}),e.jsxs("div",{className:"suggested-tickers",children:[e.jsx("h3",{children:"추천 티커:"}),e.jsx("div",{className:"ticker-tags",children:["MSFT","AAPL","NVDA","GOOGL","TSLA","AMZN","QQQ","SPY"].map(u=>e.jsx("span",{className:"ticker-tag",children:u},u))})]}),e.jsxs("div",{className:"features",children:[e.jsx("h3",{children:"주요 기능:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"📈 실시간 주식 데이터 (무료 API)"}),e.jsx("li",{children:"📊 120일 & 200일 이동평균선"}),e.jsx("li",{children:"🎯 최저 기울기 지점 분석"}),e.jsx("li",{children:"📱 반응형 디자인"})]})]})]})})]}),e.jsx("footer",{className:"app-footer",children:e.jsxs("p",{children:["Made with React + Vite |",e.jsx("a",{href:"https://github.com/yourusername/stock-app",target:"_blank",rel:"noopener noreferrer",children:"GitHub"})]})})]})}$.createRoot(document.getElementById("root")).render(e.jsx(O.StrictMode,{children:e.jsx(K,{})}));
