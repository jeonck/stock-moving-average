# React + Vite + GitHub Pages 배포 완벽 가이드

이 가이드는 React 앱을 Vite로 빌드하여 GitHub Pages에 배포할 때 발생하는 일반적인 문제들과 해결 방법을 정리한 것입니다.

## 📋 목차
1. [핵심 원칙](#핵심-원칙)
2. [프로젝트 구조](#프로젝트-구조)
3. [필수 설정 파일](#필수-설정-파일)
4. [일반적인 문제와 해결책](#일반적인-문제와-해결책)
5. [배포 체크리스트](#배포-체크리스트)

## 🎯 핵심 원칙

### ✅ DO (권장사항)
- **단순한 Vite 설정 유지**: 최소한의 설정으로 시작
- **참조 가능한 작동하는 저장소 확인**: 문제 발생 시 작동하는 저장소와 비교
- **단일 번들 접근법**: 복잡한 청크 분할보다는 단순한 단일 번들
- **표준 GitHub Actions 사용**: 공식 actions 사용
- **NODE_ENV=production 설정**: 빌드 시 반드시 설정

### ❌ DON'T (피해야 할 것)
- **과도한 polyfill 설정**: buffer, process, stream 등 불필요한 polyfill 추가
- **복잡한 빌드 설정**: manualChunks, 복잡한 alias 설정 등
- **deprecated actions 사용**: 오래된 버전의 GitHub Actions
- **gh-pages 패키지 사용**: GitHub Actions가 더 안정적

## 📁 프로젝트 구조

```
project-root/
├── .github/
│   └── workflows/
│       └── deploy.yml          # GitHub Actions 워크플로우
├── react-app/                 # React 앱 디렉토리
│   ├── src/
│   ├── public/
│   │   └── vite.svg           # 필수: favicon 파일
│   ├── package.json
│   ├── vite.config.js         # 핵심 설정 파일
│   └── dist/                  # 빌드 결과물 (자동 생성)
└── README.md
```

## 🔧 필수 설정 파일

### 1. vite.config.js (단순화 버전)
```javascript
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [react()],
  base: '/repository-name/',     // GitHub Pages용 베이스 경로
  build: {
    outDir: 'dist',
    assetsDir: 'assets',
  }
})
```

### 2. GitHub Actions 워크플로우 (.github/workflows/deploy.yml)
```yaml
name: Deploy to GitHub Pages

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    
    permissions:
      contents: read
      pages: write
      id-token: write
    
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    
    steps:
    - uses: actions/checkout@v4
    
    - uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        cache-dependency-path: react-app/package-lock.json
    
    - name: Install dependencies
      working-directory: ./react-app
      run: npm ci
    
    - name: Build
      working-directory: ./react-app
      run: npm run build
      env:
        NODE_ENV: production
    
    - name: Setup Pages
      uses: actions/configure-pages@v4
    
    - name: Upload artifact
      uses: actions/upload-pages-artifact@v3
      with:
        path: ./react-app/dist
    
    - name: Deploy to GitHub Pages
      id: deployment
      uses: actions/deploy-pages@v4
```

### 3. package.json (핵심 의존성)
```json
{
  "name": "your-project-name",
  "private": true,
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0"
  },
  "devDependencies": {
    "@vitejs/plugin-react": "^4.0.3",
    "vite": "^4.4.5"
  }
}
```

## 🚨 일반적인 문제와 해결책

### 문제 1: "배경화면만 보이고 콘텐츠가 로드되지 않음"
**원인**: 과도한 polyfill 설정, 복잡한 빌드 설정
**해결책**: 
```javascript
// ❌ 피해야 할 복잡한 설정
export default defineConfig({
  // ... 복잡한 polyfill, alias 설정들
  define: {
    'process.env': '{}',
    'global': 'globalThis',
  },
  resolve: {
    alias: {
      buffer: 'buffer',
      process: 'process/browser',
      // ... 많은 alias들
    }
  }
})

// ✅ 권장하는 단순한 설정
export default defineConfig({
  plugins: [react()],
  base: '/repository-name/',
  build: {
    outDir: 'dist',
    assetsDir: 'assets',
  }
})
```

### 문제 2: "404 favicon 오류"
**원인**: public/vite.svg 파일이 없음
**해결책**: 
1. `public/vite.svg` 파일 생성
2. 또는 `index.html`에서 favicon 참조 제거

### 문제 3: "GitHub Actions 빌드 실패"
**원인**: 
- 잘못된 working-directory 설정
- 오래된 actions 버전 사용
- NODE_ENV 설정 누락

**해결책**:
```yaml
# ✅ 올바른 설정
- name: Build
  working-directory: ./react-app  # React 앱이 있는 디렉토리
  run: npm run build
  env:
    NODE_ENV: production           # 반드시 설정

# actions 버전 확인
- uses: actions/checkout@v4        # 최신 버전 사용
- uses: actions/setup-node@v4      # 최신 버전 사용
- uses: actions/configure-pages@v4 # 최신 버전 사용
```

### 문제 4: "JavaScript 모듈 로딩 오류"
**원인**: 복잡한 청크 분할 설정
**해결책**: 
```javascript
// ❌ 복잡한 청크 분할
rollupOptions: {
  output: {
    manualChunks: {
      vendor: ['react', 'react-dom'],
      plotly: ['plotly.js', 'react-plotly.js'],
      utils: ['axios']
    }
  }
}

// ✅ 단순한 단일 번들 (설정 제거)
build: {
  outDir: 'dist',
  assetsDir: 'assets',
}
```

## ✅ 배포 체크리스트

### 배포 전 확인사항
- [ ] `vite.config.js`에서 `base` 경로가 저장소 이름과 일치하는가?
- [ ] `public/vite.svg` 파일이 존재하는가?
- [ ] `package.json`에 필수 스크립트가 있는가? (build, dev, preview)
- [ ] GitHub Actions 워크플로우에 `NODE_ENV: production`이 설정되어 있는가?
- [ ] 로컬에서 `npm run build && npm run preview`가 정상 작동하는가?

### GitHub 저장소 설정
- [ ] Settings > Pages > Source를 "GitHub Actions"로 설정했는가?
- [ ] 저장소가 Public이거나 GitHub Pro 계정인가?
- [ ] Actions 권한이 활성화되어 있는가?

### 배포 후 확인사항
- [ ] GitHub Actions 워크플로우가 성공적으로 완료되었는가?
- [ ] `https://username.github.io/repository-name/`에서 앱이 정상 로드되는가?
- [ ] 브라우저 개발자 도구에서 JavaScript 오류가 없는가?
- [ ] 모든 기능이 정상적으로 작동하는가?

## 🔍 트러블슈팅 가이드

### 단계 1: 로컬 테스트
```bash
cd react-app
npm run build
npm run preview
# http://localhost:4173/repository-name/ 에서 테스트
```

### 단계 2: 작동하는 참조 저장소와 비교
- 설정 파일들을 작동하는 저장소와 비교
- 의존성 버전 확인
- 빌드 결과물 구조 비교

### 단계 3: 단계적 단순화
1. 복잡한 Vite 설정 제거
2. 불필요한 의존성 제거
3. 기본 설정으로 시작하여 점진적으로 기능 추가

## 📚 참고 자료

- [Vite 공식 문서](https://vitejs.dev/guide/)
- [GitHub Pages 공식 문서](https://docs.github.com/pages)
- [GitHub Actions for Pages](https://github.com/actions/deploy-pages)

## 🎉 성공 사례

이 가이드를 따라 성공적으로 배포된 저장소들:
- `jeonck/vite-react-first` - 기본 Vite + React 설정
- `jeonck/stock-moving-average` - plotly.js 포함한 복잡한 앱

---

**💡 핵심 교훈**: "단순함이 최고다!" - 복잡한 설정보다는 단순하고 명확한 설정이 GitHub Pages에서 더 안정적으로 작동합니다.